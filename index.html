<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c3e50">
    
    <!-- Manifest pour PWA -->
    <link rel="manifest" href="manifest.json">
    
    <title>Assembl√©e des Saints R√©unis de Binanga</title>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('Service Worker enregistr√© avec succ√®s:', registration);
                }).catch(error => {
                    console.log('√âchec de l\'enregistrement du Service Worker:', error);
                });
            });
        }
    </script>
    
    <style>
        /* Variables CSS */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --gold-color: #d4af37;
            --purple-color: #8e44ad;
            --light-color: #f9f9f9;
            --dark-color: #1a252f;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        /* Reset et styles de base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
        }

        /* En-t√™te simplifi√© */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .header::before {
            content: "‚úù";
            position: absolute;
            font-size: 8rem;
            opacity: 0.1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .logo-container {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .church-logo {
            width: 150px;
            height: 150px;
            object-fit: contain;
            border-radius: 0;
            margin-bottom: 0.5rem;
        }

        .logo-placeholder {
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--gold-color);
            background: transparent;
            box-shadow: none;
            border-radius: 0;
            margin-bottom: 0.5rem;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
            color: white;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Admin button dans header */
        .admin-access {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .gospel-message {
            background: rgba(212, 175, 55, 0.2);
            border-left: 4px solid var(--gold-color);
            padding: 0.6rem;
            margin-top: 1rem;
            border-radius: 4px;
            font-style: italic;
            font-size: 0.85rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Contenu principal */
        .main-content {
            flex: 1;
            padding: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        /* Boutons d'action principaux */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        @media (max-width: 600px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: var(--border-radius);
            padding: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            gap: 0.5rem;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-prayer {
            background: linear-gradient(135deg, var(--purple-color), #9b59b6);
            color: white;
        }

        .btn-prayer:hover:not(:disabled) {
            background: linear-gradient(135deg, #7d3c98, #8e44ad);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
        }

        .btn-bible {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
        }

        .btn-bible:hover:not(:disabled) {
            background: linear-gradient(135deg, #219653, #27ae60);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .btn-pastor {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
            width: 100%;
            margin-top: 0.5rem;
        }

        .btn-pastor:hover:not(:disabled) {
            background: linear-gradient(135deg, #16a085, #1abc9c);
            transform: translateY(-2px);
        }

        .btn-admin {
            background: linear-gradient(135deg, var(--accent-color), #c0392b);
            color: white;
            padding: 0.7rem 1.5rem;
            font-size: 0.9rem;
        }

        .btn-admin:hover:not(:disabled) {
            background: linear-gradient(135deg, #c0392b, var(--accent-color));
            transform: translateY(-2px);
        }

        .btn-program {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            width: 100%;
            margin-top: 0.5rem;
        }

        .btn-program:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, var(--secondary-color));
            transform: translateY(-2px);
        }

        .btn-sermons {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            width: 100%;
            margin-top: 0.5rem;
        }

        .btn-sermons:hover:not(:disabled) {
            background: linear-gradient(135deg, #d35400, #e67e22);
            transform: translateY(-2px);
        }

        /* Sections de contenu (masqu√©es par d√©faut) */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--secondary-color);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
            display: flex;
            align-items: center;
        }

        .icon {
            margin-right: 0.8rem;
            font-size: 1.3rem;
        }

        /* Contenu des cartes */
        .program-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--secondary-color);
            transition: var(--transition);
        }

        .program-item:hover {
            transform: translateX(5px);
        }

        .program-item h3 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .program-item p {
            margin-bottom: 0.3rem;
            padding-left: 1.5rem;
        }

        .program-time {
            color: var(--secondary-color);
            font-weight: bold;
        }

        /* Section pri√®re du jour */
        .prayer-section {
            background: linear-gradient(135deg, #f0f7ff, #e3f2fd);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .prayer-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .prayer-topic {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.2rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--purple-color);
            display: none;
        }

        .prayer-topic.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .verse {
            font-style: italic;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid var(--gold-color);
        }

        .timer {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timer.warning {
            color: #e74c3c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .prayer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--purple-color), #9b59b6);
            color: white;
            padding: 0.8rem 1.5rem;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 0.8rem 1.5rem;
        }

        .btn-resume {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 0.8rem 1.5rem;
        }

        .btn-finish {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
            padding: 0.8rem 1.5rem;
        }

        .prayer-progress {
            margin-top: 1rem;
            text-align: center;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #9b59b6);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Section pr√©dications */
        .sermons-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .sermons-list {
            margin-top: 1rem;
        }

        .sermon-item {
            background: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--gold-color);
        }

        .sermon-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .sermon-title {
            font-weight: bold;
            color: var(--dark-color);
            flex: 1;
        }

        .sermon-date {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-left: 1rem;
        }

        .sermon-pastor {
            color: var(--secondary-color);
            font-style: italic;
            margin-bottom: 0.5rem;
        }

        .sermon-audio {
            width: 100%;
            margin-top: 0.5rem;
        }

        .empty-sermons {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 2rem;
        }

        /* Section quiz biblique */
        .quiz-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .level-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .level-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
        }

        .level-dot.active {
            background: var(--success-color);
        }

        .level-dot.completed {
            background: var(--secondary-color);
        }

        .question-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 1.2rem;
            color: var(--dark-color);
        }

        .options-container {
            display: grid;
            gap: 0.8rem;
        }

        .option {
            padding: 0.8rem;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .option:hover:not(.selected) {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .option.selected.correct {
            background: #d4edda;
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .option.selected.incorrect {
            background: #f8d7da;
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .option.selected {
            pointer-events: none;
        }

        .quiz-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .quiz-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .level-result {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1rem;
            text-align: center;
            display: none;
        }

        .level-result.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .level-score {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success-color);
            margin: 1rem 0;
        }

        .level-message {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: var(--border-radius);
        }

        .level-message.success {
            background: #d4edda;
            border-left: 4px solid var(--success-color);
            color: var(--dark-color);
        }

        .level-message.fail {
            background: #f8d7da;
            border-left: 4px solid var(--accent-color);
            color: var(--dark-color);
        }

        /* Section enregistrements admin - CORRIG√âE */
        .admin-section {
            border: 2px solid var(--accent-color);
        }

        .recorder-container {
            margin-top: 1rem;
        }

        .recorder-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .btn-record {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
        }

        .btn-stop {
            background: linear-gradient(135deg, var(--accent-color), #c0392b);
            color: white;
        }

        .recording-status {
            display: flex;
            align-items: center;
            color: var(--accent-color);
            font-weight: bold;
            margin-left: 1rem;
        }

        .pulse {
            width: 12px;
            height: 12px;
            background-color: var(--accent-color);
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 1.5s infinite;
        }

        .sermon-form {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-group input:focus {
            border-color: var(--secondary-color);
            outline: none;
        }

        /* √âtat de pr√©paration du microphone */
        .mic-status {
            padding: 0.8rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: none;
        }

        .mic-status.ready {
            background: #d4edda;
            border-left: 4px solid var(--success-color);
            color: var(--dark-color);
            display: block;
        }

        .mic-status.error {
            background: #f8d7da;
            border-left: 4px solid var(--accent-color);
            color: var(--dark-color);
            display: block;
        }

        .mic-status.warning {
            background: #fff3cd;
            border-left: 4px solid var(--warning-color);
            color: var(--dark-color);
            display: block;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.3rem;
            margin: 0;
        }

        .btn-close {
            background: transparent;
            color: white;
            font-size: 1.8rem;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-body input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            width: 100%;
            padding: 0.9rem;
        }

        /* Pied de page */
        .footer {
            background: linear-gradient(135deg, var(--dark-color), var(--primary-color));
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .app-version {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        .creator {
            font-size: 0.8rem;
            color: var(--gold-color);
            margin-top: 0.5rem;
        }

        /* Banni√®re d'installation */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 0.8rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .install-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.8rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .install-icon {
            font-size: 1.5rem;
        }
        
        .install-text {
            flex: 1;
            line-height: 1.3;
        }
        
        .install-text small {
            opacity: 0.8;
            display: block;
            font-size: 0.75rem;
        }
        
        .btn-install {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .btn-install:hover {
            background: #219653;
            transform: translateY(-2px);
        }
        
        .btn-dismiss {
            background: transparent;
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 0.5rem;
        }

        /* Utilitaires */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .active-section {
            display: block !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }

        .reminder {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-top: 1rem;
            border-left: 4px solid var(--warning-color);
            text-align: center;
        }

        .back-button {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            margin-bottom: 1rem;
        }

        .back-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
            transform: translateY(-2px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 4px solid var(--success-color);
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            max-width: 300px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .church-logo, .logo-placeholder {
                width: 120px;
                height: 120px;
            }
            
            .logo-placeholder {
                font-size: 3rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .prayer-controls, .quiz-controls {
                flex-direction: column;
            }
            
            .install-content {
                flex-wrap: wrap;
                justify-content: center;
                text-align: center;
            }
            
            .install-text {
                order: 2;
                width: 100%;
                margin-top: 0.5rem;
            }
        }
        
        @media (max-width: 400px) {
            .church-logo, .logo-placeholder {
                width: 100px;
                height: 100px;
            }
            
            .logo-placeholder {
                font-size: 2.5rem;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .install-content {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-t√™te simplifi√© avec logo seul -->
        <header class="header">
            <div class="admin-access">
                <button id="adminBtn" class="btn-admin">üîê Admin</button>
            </div>
            <div class="logo-container">
                <img src="binanga.png" alt="Logo de l'√©glise" class="church-logo" onerror="this.style.display='none'; document.querySelector('.logo-placeholder').style.display='flex';">
                <div class="logo-placeholder" style="display: none;">‚úù</div>
                <h1>Assembl√©e des Saints R√©unis de Binanga</h1>
            </div>
            <div class="gospel-message">
                "Car je n'ai pas eu la pens√©e de savoir parmi vous autre chose que J√©sus-Christ, et J√©sus-Christ crucifi√©."<br>
                <em>1 Corinthiens 2:2</em>
            </div>
        </header>

        <!-- Contenu principal -->
        <main class="main-content">
            <!-- Boutons d'action principaux -->
            <div class="action-buttons">
                <button id="prayerBtn" class="btn-prayer">
                    <span class="icon">üôè</span> Pri√®re du jour
                </button>
                <button id="bibleQuizBtn" class="btn-bible">
                    <span class="icon">üìñ</span> Je connais la Bible
                </button>
            </div>

            <!-- Boutons secondaires -->
            <button id="programBtn" class="btn-program">
                <span class="icon">üìÖ</span> Voir les programmes
            </button>

            <button id="sermonsBtn" class="btn-sermons">
                <span class="icon">üéµ</span> √âcouter les pr√©dications
            </button>

            <button id="pastorBtn" class="btn-pastor">
                <span class="icon">üí¨</span> Message au pasteur
            </button>

            <!-- Section programmes -->
            <div id="programSection" class="content-section">
                <button class="back-button" onclick="showMainButtons()">
                    <span class="icon">‚Üê</span> Retour
                </button>
                <section class="card">
                    <h2><span class="icon">üìÖ</span> Programmes de la semaine</h2>
                    <div class="content">
                        <div class="program-item">
                            <h3><span class="icon">‚è∞</span> MERCREDI</h3>
                            <p><span class="program-time">17h - 19h :</span> ENSEIGNEMENT ET PRI√àRE</p>
                        </div>
                        <div class="program-item">
                            <h3><span class="icon">üåô</span> JEUDI</h3>
                            <p><span class="program-time">23h - 3h :</span> NUIT DE PRI√àRE</p>
                        </div>
                        <div class="program-item">
                            <h3><span class="icon">‚è∞</span> VENDREDI</h3>
                            <p><span class="program-time">17h - 19h :</span> ENSEIGNEMENT ET PRI√àRE</p>
                        </div>
                        <div class="program-item">
                            <h3><span class="icon">üôè</span> SAMEDI</h3>
                            <p><span class="program-time">8h - 12h :</span> INTERCESSION</p>
                        </div>
                        <div class="program-item">
                            <h3><span class="icon">‚úù</span> DIMANCHE</h3>
                            <p><span class="program-time">8h - 10h30 :</span> CULTE D'ADORATION</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Section pr√©dications -->
            <div id="sermonsSection" class="content-section">
                <button class="back-button" onclick="showMainButtons()">
                    <span class="icon">‚Üê</span> Retour
                </button>
                
                <div class="sermons-section">
                    <div class="quiz-header">
                        <h2>üéµ Pr√©dications enregistr√©es</h2>
                        <p>√âcoutez les messages spirituels de l'√©glise</p>
                    </div>

                    <div id="sermonsList" class="sermons-list">
                        <div class="empty-sermons">
                            Aucune pr√©dication disponible pour le moment.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section pri√®re du jour -->
            <div id="prayerSection" class="content-section">
                <button class="back-button" onclick="showMainButtons()">
                    <span class="icon">‚Üê</span> Retour
                </button>
                
                <div class="prayer-section">
                    <div class="prayer-header">
                        <h2>üôè Pri√®re du jour - Mercredi 17 d√©cembre 2025</h2>
                        <p><strong>TH√àME :</strong> PRI√àRE POUR BIEN TERMINER L'ANN√âE 2025 ET PR√âPARER L'AVENIR</p>
                    </div>

                    <div class="prayer-progress">
                        <div class="progress-text">
                            Sujet <span id="currentTopicNumber">1</span> sur 9
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>

                    <div id="prayerTopics">
                        <!-- Les sujets de pri√®re seront ins√©r√©s ici dynamiquement -->
                    </div>

                    <div class="timer" id="prayerTimer">10:00</div>

                    <div class="prayer-controls">
                        <button id="startPrayerBtn" class="btn-start">üöÄ Commencer la pri√®re</button>
                        <button id="pausePrayerBtn" class="btn-pause hidden">‚è∏Ô∏è Pause</button>
                        <button id="resumePrayerBtn" class="btn-resume hidden">‚ñ∂Ô∏è Reprendre</button>
                        <button id="finishPrayerBtn" class="btn-finish hidden">‚úÖ Terminer la pri√®re</button>
                    </div>

                    <div id="prayerClosure" class="hidden mt-2">
                        <div class="message-item">
                            <h3>Pri√®re de cl√¥ture</h3>
                            <p>Seigneur notre Dieu, nous Te remercions pour ce temps de pri√®re. Merci pour Ta pr√©sence au milieu de nous. Nous Te remettons nos vies, nos familles et notre avenir. Aide-nous √† marcher chaque jour selon Ta volont√©. Donne-nous la paix dans nos c≈ìurs et la force d'avancer avec confiance. Nous Te faisons confiance pour la suite. Au nom de J√©sus, Amen.</p>
                        </div>
                        
                        <div class="reminder">
                            <h3>üì¢ Rappel important</h3>
                            <p>Il y aura r√©union de pri√®re aujourd'hui √† <strong>17h00</strong>.<br>
                            Tout le monde est pri√© d'√™tre pr√©sent.</p>
                            <p>Que Dieu vous b√©nisse et vous garde.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section quiz biblique -->
            <div id="quizSection" class="content-section">
                <button class="back-button" onclick="showMainButtons()">
                    <span class="icon">‚Üê</span> Retour
                </button>
                
                <div class="quiz-section">
                    <div class="quiz-header">
                        <h2>üìñ Quiz Biblique - Le livre de la Gen√®se</h2>
                        <p>7 niveaux, 10 questions par niveau - 2 minutes par niveau</p>
                        <p><small>Score requis pour passer au niveau suivant : 10/10</small></p>
                    </div>

                    <div class="level-indicator" id="levelIndicator">
                        <!-- Les indicateurs de niveau seront ins√©r√©s ici -->
                    </div>

                    <div class="quiz-timer" id="quizTimer">120</div>

                    <div class="question-container">
                        <div class="question-text" id="questionText"></div>
                        <div class="options-container" id="optionsContainer"></div>
                    </div>

                    <div class="level-result" id="levelResult">
                        <h3>R√©sultats du Niveau <span id="resultLevelNumber">1</span></h3>
                        <div class="level-score" id="levelScore">0/10</div>
                        <div class="level-message" id="levelMessage"></div>
                        <button id="continueQuizBtn" class="btn-start mt-1">Continuer</button>
                        <button id="retryLevelBtn" class="btn-pause mt-1">R√©essayer ce niveau</button>
                    </div>

                    <div class="quiz-controls">
                        <button id="startQuizBtn" class="btn-start">üéØ Commencer le quiz</button>
                        <button id="nextQuestionBtn" class="btn-next hidden">‚û°Ô∏è Question suivante</button>
                        <button id="endQuizBtn" class="btn-finish hidden">üèÅ Terminer le quiz</button>
                    </div>

                    <div id="quizResults" class="hidden mt-2">
                        <!-- Les r√©sultats finaux seront affich√©s ici -->
                    </div>
                </div>
            </div>

            <!-- Section enregistrements admin - CORRIG√âE -->
            <div id="adminContentSection" class="content-section">
                <button class="back-button" onclick="showMainButtons()">
                    <span class="icon">‚Üê</span> Retour
                </button>
                
                <section class="card admin-section" id="recordingsSection">
                    <h2><span class="icon">üé§</span> Enregistrer une nouvelle pr√©dication</h2>
                    <div class="content">
                        <div id="micStatus" class="mic-status warning">
                            ‚ö†Ô∏è Test du microphone en cours... Cliquez sur "Tester le micro" ci-dessous.
                        </div>
                        
                        <div class="sermon-form">
                            <div class="form-group">
                                <label for="sermonTitle">Th√®me de la pr√©dication *</label>
                                <input type="text" id="sermonTitle" placeholder="Ex: La foi qui triomphe" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="sermonPreacher">Nom du pr√©dicateur *</label>
                                <input type="text" id="sermonPreacher" placeholder="Ex: Pasteur Mando" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="sermonDate">Date de la pr√©dication *</label>
                                <input type="date" id="sermonDate" required>
                            </div>
                        </div>

                        <div class="recorder-container">
                            <div class="recorder-controls">
                                <button id="testMicBtn" class="btn-record">
                                    <span class="icon">üé§</span> Tester le micro
                                </button>
                                <button id="startRecordBtn" class="btn-record" disabled>
                                    <span class="icon">‚è∫Ô∏è</span> D√©marrer l'enregistrement
                                </button>
                                <button id="stopRecordBtn" class="btn-stop hidden" disabled>
                                    <span class="icon">‚èπÔ∏è</span> Arr√™ter
                                </button>
                                <div class="recording-status hidden" id="recordingStatus">
                                    <div class="pulse"></div>
                                    <span>Enregistrement en cours...</span>
                                </div>
                            </div>
                            
                            <div class="audio-preview hidden" id="audioPreview">
                                <h3>Pr√©visualisation:</h3>
                                <audio id="audioPlayer" controls></audio>
                                <button id="saveRecordingBtn" class="btn-save">
                                    <span class="icon">üíæ</span> Sauvegarder la pr√©dication
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="card admin-section" id="adminControlsSection">
                    <h2><span class="icon">‚öôÔ∏è</span> Administration</h2>
                    <div class="content">
                        <div class="admin-controls">
                            <button id="logoutBtn" class="btn-logout">
                                <span class="icon">üîí</span> D√©connexion administrateur
                            </button>
                            <div class="admin-info">
                                <p><strong>Mode administrateur actif</strong></p>
                                <p>Vous pouvez maintenant enregistrer des pr√©dications audio.</p>
                                <p><small>Pour acc√©der aux pr√©dications enregistr√©es, utilisez le bouton "√âcouter les pr√©dications" sur la page d'accueil.</small></p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Pied de page -->
        <footer class="footer">
            <p>¬© 2025 Assembl√©e des Saints R√©unis de Binanga</p>
            <p class="app-version">Application v3.0 - Fonctionne hors connexion</p>
            <p class="creator">Cr√©√©e par MandO'Tech</p>
        </footer>
    </div>

    <!-- Banni√®re d'installation PWA -->
    <div id="installBanner" class="install-banner hidden">
        <div class="install-content">
            <span class="install-icon">‚¨áÔ∏è</span>
            <div class="install-text">
                <strong>Installer l'application</strong>
                <small>Pour une meilleure exp√©rience hors ligne</small>
            </div>
            <button id="installBannerBtn" class="btn-install">Installer</button>
            <button id="dismissBannerBtn" class="btn-dismiss">&times;</button>
        </div>
    </div>

    <!-- Modal pour l'authentification admin -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Acc√®s administrateur</h2>
                <button id="closeModalBtn" class="btn-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Veuillez entrer le mot de passe administrateur:</p>
                <input type="password" id="adminPassword" placeholder="Mot de passe" autocomplete="off">
                <div id="passwordError" class="error-message hidden">Mot de passe incorrect</div>
                <button id="submitPasswordBtn" class="btn-submit">Valider</button>
            </div>
        </div>
    </div>

    <!-- Script principal CORRIG√â -->
    <script>
        // ===============================
        // DONN√âES DE L'APPLICATION
        // ===============================

        // Donn√©es de pri√®re du jour
        const prayerData = [
            {
                verse: "Psaume 103:1-2 - ¬´ Mon √¢me, b√©nis l'√âternel, et n'oublie aucun de ses bienfaits ! ¬ª",
                content: "Prenons ce temps pour louer Dieu. Remercions-Le pour la vie, pour la protection et pour tout ce qu'Il nous a donn√© durant l'ann√©e 2025. Reconnaissons que c'est gr√¢ce √† Lui que nous sommes encore debout aujourd'hui."
            },
            {
                verse: "Psaume 66:18 - ¬´ Si j'avais gard√© le p√©ch√© dans mon c≈ìur, le Seigneur ne m'aurait pas √©cout√©. ¬ª",
                content: "Approchons-nous de Dieu avec humilit√©. Demandons pardon pour nos fautes, nos erreurs, nos mauvaises paroles et nos mauvaises attitudes. Prions pour que Dieu nous pardonne et nous donne un c≈ìur nouveau."
            },
            {
                verse: "Psaume 90:12 - ¬´ Enseigne-nous √† bien utiliser nos jours, afin que notre c≈ìur devienne sage. ¬ª",
                content: "Demandons √† Dieu de nous aider √† comprendre ce que l'ann√©e 2025 nous a appris. Prions pour la sagesse afin de faire de meilleurs choix √† l'avenir."
            },
            {
                verse: "Proverbes 3:5-6 - ¬´ Confie-toi en l'√âternel de tout ton c≈ìur‚Ä¶ et Il aplanira tes chemins. ¬ª",
                content: "Confions √† Dieu nos pens√©es, nos d√©cisions et nos projets. Prions pour qu'Il nous guide clairement et nous montre le bon chemin √† suivre."
            },
            {
                verse: "Psaume 127:1 - ¬´ Si l'√âternel ne b√¢tit la maison, ceux qui la b√¢tissent travaillent en vain. ¬ª",
                content: "Remettons entre les mains de Dieu nos familles, notre travail et nos projets. Demandons-Lui de diriger tout ce que nous faisons, afin que cela porte de bons fruits."
            },
            {
                verse: "Proverbes 4:18 - ¬´ Le chemin des justes brille de plus en plus‚Ä¶ ¬ª",
                content: "Prions pour avancer progressivement. Demandons √† Dieu de nous aider √† aller de l'avant, m√™me petit √† petit, sans reculer ni abandonner."
            },
            {
                verse: "Philippiens 4:6 - ¬´ Ne vous inqui√©tez de rien‚Ä¶ ¬ª",
                content: "Pr√©sentons √† Dieu nos inqui√©tudes et nos peurs concernant l'avenir. Demandons-Lui Sa paix dans nos c≈ìurs et la confiance pour demain."
            },
            {
                verse: "√âph√©siens 6:11 - ¬´ Rev√™tez-vous de toutes les armes de Dieu‚Ä¶ ¬ª",
                content: "Entrons dans le combat spirituel. Prions contre toute opposition, tout d√©couragement et toute confusion qui pourraient freiner notre avanc√©e. D√©clarons que Dieu nous soutient et nous fortifie."
            },
            {
                verse: "Psaume 37:5 - ¬´ Recommande ton sort √† l'√âternel, mets en Lui ta confiance, et Il agira. ¬ª",
                content: "Terminons en confiant enti√®rement notre avenir √† Dieu. Prions pour Lui faire confiance en toute chose et attendre Son intervention."
            }
        ];

        // Donn√©es du quiz biblique (abr√©g√©es pour √©conomiser de l'espace)
        const allQuizQuestions = [
            {
                question: "Quel est le premier livre de la Bible ?",
                options: ["L'Exode", "La Gen√®se", "Le L√©vitique", "Les Nombres"],
                correct: 1,
                verse: "Gen√®se 1:1",
                level: 0
            },
            {
                question: "Qui a cr√©√© le ciel et la terre ?",
                options: ["Adam", "No√©", "Dieu", "Mo√Øse"],
                correct: 2,
                verse: "Gen√®se 1:1",
                level: 0
            }
        ];

        // ===============================
        // VARIABLES GLOBALES PWA
        // ===============================
        let deferredPrompt = null;
        let currentPrayerTopic = 0;
        let prayerTimerInterval = null;
        let prayerTimeLeft = 600;
        let isPrayerPaused = false;

        let quizData = [];
        let currentQuizLevel = 0;
        let currentQuestion = 0;
        let quizScore = 0;
        let currentLevelScore = 0;
        let quizTimerInterval = null;
        let quizTimeLeft = 120;
        let isQuizActive = false;

        let mediaRecorder = null;
        let audioChunks = [];
        let audioBlob = null;
        let stream = null;
        let isMicrophoneTested = false;

        // Stockage local pour les pr√©dications
        let sermons = JSON.parse(localStorage.getItem('sermons')) || [];

        // ===============================
        // FONCTIONS PWA
        // ===============================
        function initializePWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                setTimeout(() => {
                    const installBanner = document.getElementById('installBanner');
                    if (installBanner && deferredPrompt) {
                        installBanner.classList.remove('hidden');
                    }
                }, 3000);
            });

            window.addEventListener('appinstalled', () => {
                deferredPrompt = null;
                const installBanner = document.getElementById('installBanner');
                if (installBanner) {
                    installBanner.classList.add('hidden');
                }
                showNotification('Application install√©e avec succ√®s!', 'success');
            });

            const installBannerBtn = document.getElementById('installBannerBtn');
            if (installBannerBtn) {
                installBannerBtn.addEventListener('click', async () => {
                    if (!deferredPrompt) return;
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('Utilisateur a accept√© l\'installation');
                    }
                    deferredPrompt = null;
                });
            }

            const dismissBannerBtn = document.getElementById('dismissBannerBtn');
            if (dismissBannerBtn) {
                dismissBannerBtn.addEventListener('click', () => {
                    const installBanner = document.getElementById('installBanner');
                    if (installBanner) {
                        installBanner.classList.add('hidden');
                    }
                });
            }
        }

        // ===============================
        // FONCTIONS DE BASE
        // ===============================
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function showMainButtons() {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active-section');
            });
            
            document.querySelector('.action-buttons').style.display = 'grid';
            document.getElementById('programBtn').style.display = 'block';
            document.getElementById('sermonsBtn').style.display = 'block';
            document.getElementById('pastorBtn').style.display = 'block';
        }

        function hideMainButtons() {
            document.querySelector('.action-buttons').style.display = 'none';
            document.getElementById('programBtn').style.display = 'none';
            document.getElementById('sermonsBtn').style.display = 'none';
            document.getElementById('pastorBtn').style.display = 'none';
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active-section');
            });
            
            hideMainButtons();
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active-section');
                
                if (sectionId === 'sermonsSection') {
                    loadSermons();
                }
                
                // Initialiser le test de microphone si on va dans la section admin
                if (sectionId === 'adminContentSection' && !isMicrophoneTested) {
                    updateMicStatus('warning', '‚ö†Ô∏è Test du microphone en cours... Cliquez sur "Tester le micro".');
                }
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.borderLeftColor = type === 'success' ? 'var(--success-color)' : 
                                               type === 'error' ? 'var(--accent-color)' : 
                                               'var(--warning-color)';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : 'üîî'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // ===============================
        // FONCTIONNALIT√âS MICROPHONE CORRIG√âES
        // ===============================
        function updateMicStatus(type, message) {
            const micStatus = document.getElementById('micStatus');
            if (micStatus) {
                micStatus.className = `mic-status ${type}`;
                micStatus.innerHTML = message;
            }
        }

        async function testMicrophone() {
            const micStatus = document.getElementById('micStatus');
            if (!micStatus) return;
            
            updateMicStatus('warning', 'üé§ Test du microphone en cours...');
            
            try {
                // Lib√©rer le stream pr√©c√©dent s'il existe
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    stream = null;
                }
                
                // Tenter d'acc√©der au microphone avec des param√®tres simples
                stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100,
                        channelCount: 1
                    },
                    video: false
                });
                
                // V√©rifier si le stream contient bien des pistes audio
                if (stream.getAudioTracks().length === 0) {
                    throw new Error('Aucune piste audio d√©tect√©e');
                }
                
                // Tester si le micro capte du son
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(stream);
                const analyser = audioContext.createAnalyser();
                source.connect(analyser);
                
                // Cr√©er un buffer pour analyser le son
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                // Analyser pendant 1 seconde
                setTimeout(() => {
                    analyser.getByteFrequencyData(dataArray);
                    
                    // Calculer le volume moyen
                    let sum = 0;
                    for (let i = 0; i < bufferLength; i++) {
                        sum += dataArray[i];
                    }
                    const average = sum / bufferLength;
                    
                    // Fermer l'audioContext
                    audioContext.close();
                    
                    if (average > 5) {
                        updateMicStatus('ready', '‚úÖ Microphone test√© avec succ√®s ! Son d√©tect√©. Vous pouvez maintenant enregistrer.');
                        isMicrophoneTested = true;
                        document.getElementById('startRecordBtn').disabled = false;
                        document.getElementById('testMicBtn').textContent = 'üé§ Micro OK';
                        document.getElementById('testMicBtn').style.background = 'linear-gradient(135deg, var(--success-color), #2ecc71)';
                        showNotification('Microphone test√© avec succ√®s !', 'success');
                    } else {
                        updateMicStatus('warning', '‚ö†Ô∏è Microphone accessible mais aucun son d√©tect√©. Parlez dans le micro pour tester.');
                        document.getElementById('startRecordBtn').disabled = false;
                        isMicrophoneTested = true;
                        showNotification('Microphone accessible, mais aucun son d√©tect√©. V√©rifiez votre microphone.', 'warning');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Erreur d√©taill√©e du microphone:', error);
                
                let message = "Erreur inconnue avec le microphone.";
                let detailedMessage = `Code: ${error.name || 'Inconnu'}`;
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    message = "‚ùå Permission refus√©e par le navigateur.";
                    detailedMessage = "Cliquez sur l'ic√¥ne du cadenas (üîí) dans la barre d'adresse et autorisez l'acc√®s au microphone.";
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    message = "‚ùå Aucun microphone trouv√©.";
                    detailedMessage = "V√©rifiez qu'un microphone est connect√© et qu'il n'est pas utilis√© par une autre application.";
                } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
                    message = "‚ùå Microphone d√©j√† utilis√©.";
                    detailedMessage = "Fermez les applications qui utilisent le microphone (Zoom, Teams, Skype, etc.).";
                } else if (error.name === 'SecurityError') {
                    message = "‚ùå Probl√®me de s√©curit√©.";
                    detailedMessage = "Ouvrez l'application depuis un serveur local (http://localhost) et non depuis un fichier (file://).";
                } else if (error.message && error.message.includes('requested device not found')) {
                    message = "‚ùå P√©riph√©rique non trouv√©.";
                    detailedMessage = "Le microphone s√©lectionn√© n'est plus disponible.";
                }
                
                updateMicStatus('error', `${message}<br><small>${detailedMessage}</small>`);
                document.getElementById('startRecordBtn').disabled = true;
                isMicrophoneTested = false;
                
                // Afficher des instructions d√©taill√©es
                showNotification(message, 'error');
                
                // Instructions suppl√©mentaires pour Chrome
                if (window.chrome) {
                    setTimeout(() => {
                        showNotification('Pour Chrome: 1) Ouvrez chrome://settings/content/microphone 2) Autorisez localhost', 'warning');
                    }, 1000);
                }
            }
        }

        async function startRecording() {
            if (!isMicrophoneTested) {
                showNotification('Veuillez d\'abord tester le microphone.', 'error');
                return;
            }
            
            const title = document.getElementById('sermonTitle').value.trim();
            const preacher = document.getElementById('sermonPreacher').value.trim();
            const date = document.getElementById('sermonDate').value;
            
            if (!title || !preacher || !date) {
                showNotification('Veuillez remplir tous les champs du formulaire', 'error');
                return;
            }
            
            try {
                // Si le stream n'existe plus, le recr√©er
                if (!stream || stream.active === false) {
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        }
                    });
                }
                
                // Options d'enregistrement compatibles
                const options = {
                    mimeType: 'audio/webm;codecs=opus'
                };
                
                // V√©rifier si le format est support√©
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'audio/webm';
                    if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                        options.mimeType = 'audio/mp4';
                        if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                            options.mimeType = '';
                        }
                    }
                }
                
                mediaRecorder = new MediaRecorder(stream, options);
                audioChunks = [];
                
                mediaRecorder.addEventListener('dataavailable', event => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                });
                
                mediaRecorder.addEventListener('stop', () => {
                    audioBlob = new Blob(audioChunks, { 
                        type: mediaRecorder.mimeType || 'audio/webm' 
                    });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    const audioPlayer = document.getElementById('audioPlayer');
                    if (audioPlayer) {
                        audioPlayer.src = audioUrl;
                        document.getElementById('audioPreview').classList.remove('hidden');
                    }
                });
                
                // D√©marrer l'enregistrement
                mediaRecorder.start(100);
                
                // Mettre √† jour l'interface
                document.getElementById('startRecordBtn').classList.add('hidden');
                document.getElementById('stopRecordBtn').classList.remove('hidden');
                document.getElementById('stopRecordBtn').disabled = false;
                document.getElementById('recordingStatus').classList.remove('hidden');
                document.getElementById('testMicBtn').disabled = true;
                
                updateMicStatus('ready', '‚óè Enregistrement en cours... Parlez normalement.');
                showNotification("Enregistrement d√©marr√©", 'success');
                
            } catch (error) {
                console.error('Erreur lors du d√©marrage de l\'enregistrement:', error);
                showNotification(`Erreur d'enregistrement: ${error.message}`, 'error');
                updateMicStatus('error', '‚ùå Erreur lors du d√©marrage de l\'enregistrement');
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                
                document.getElementById('stopRecordBtn').disabled = true;
                document.getElementById('recordingStatus').classList.add('hidden');
                document.getElementById('testMicBtn').disabled = false;
                
                updateMicStatus('ready', '‚úÖ Enregistrement termin√©. √âcoutez la pr√©visualisation ci-dessous.');
                showNotification("Enregistrement termin√©", 'success');
            }
        }

        function saveRecording() {
            if (!audioBlob) {
                showNotification('Aucun enregistrement √† sauvegarder', 'error');
                return;
            }
            
            const title = document.getElementById('sermonTitle').value.trim();
            const preacher = document.getElementById('sermonPreacher').value.trim();
            const date = document.getElementById('sermonDate').value;
            
            if (!title || !preacher || !date) {
                showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            const sermon = {
                id: Date.now().toString(),
                title: title,
                preacher: preacher,
                date: date,
                audioUrl: URL.createObjectURL(audioBlob),
                created: new Date().toISOString()
            };
            
            sermons.push(sermon);
            localStorage.setItem('sermons', JSON.stringify(sermons));
            
            // R√©initialiser le formulaire
            document.getElementById('sermonTitle').value = '';
            document.getElementById('sermonPreacher').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sermonDate').value = today;
            
            // R√©initialiser l'interface
            audioBlob = null;
            document.getElementById('audioPreview').classList.add('hidden');
            document.getElementById('audioPlayer').src = '';
            document.getElementById('startRecordBtn').classList.remove('hidden');
            document.getElementById('stopRecordBtn').classList.add('hidden');
            
            updateMicStatus('ready', '‚úÖ Pr√©dication sauvegard√©e ! Vous pouvez faire un nouvel enregistrement.');
            showNotification('Pr√©dication sauvegard√©e avec succ√®s!', 'success');
            
            if (document.getElementById('sermonsSection').classList.contains('active-section')) {
                loadSermons();
            }
        }

        // ===============================
        // FONCTIONNALIT√âS DES PR√âDICATIONS
        // ===============================
        function loadSermons() {
            const sermonsList = document.getElementById('sermonsList');
            sermons = JSON.parse(localStorage.getItem('sermons')) || [];
            
            if (sermons.length === 0) {
                sermonsList.innerHTML = '<div class="empty-sermons">Aucune pr√©dication disponible pour le moment.</div>';
                return;
            }
            
            sermons.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '';
            sermons.forEach((sermon, index) => {
                const date = new Date(sermon.date).toLocaleDateString('fr-FR');
                html += `
                    <div class="sermon-item">
                        <div class="sermon-header">
                            <div class="sermon-title">${sermon.title}</div>
                            <div class="sermon-date">${date}</div>
                        </div>
                        <div class="sermon-pastor">Pr√©dicateur: ${sermon.preacher}</div>
                        <audio controls class="sermon-audio">
                            <source src="${sermon.audioUrl}" type="audio/webm">
                            Votre navigateur ne supporte pas l'√©l√©ment audio.
                        </audio>
                    </div>
                `;
            });
            
            sermonsList.innerHTML = html;
        }

        // ===============================
        // FONCTIONNALIT√âS DU QUIZ
        // ===============================
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function initializeQuizData() {
            quizData = [];
            for (let level = 0; level < 7; level++) {
                const levelQuestions = allQuizQuestions.filter(q => q.level === level);
                const shuffledQuestions = shuffleArray(levelQuestions);
                quizData.push(...shuffledQuestions);
            }
        }

        function initializeQuizSection() {
            const levelIndicator = document.getElementById('levelIndicator');
            levelIndicator.innerHTML = '';
            
            for (let i = 0; i < 7; i++) {
                const dot = document.createElement('div');
                dot.className = 'level-dot';
                dot.id = `levelDot${i}`;
                levelIndicator.appendChild(dot);
            }
            
            updateLevelIndicator();
        }

        function updateLevelIndicator() {
            document.querySelectorAll('.level-dot').forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index === currentQuizLevel) {
                    dot.classList.add('active');
                } else if (index < currentQuizLevel) {
                    dot.classList.add('completed');
                }
            });
        }

        function startQuiz() {
            initializeQuizData();
            currentQuizLevel = 0;
            currentQuestion = 0;
            quizScore = 0;
            currentLevelScore = 0;
            quizTimeLeft = 120;
            isQuizActive = true;
            
            document.getElementById('startQuizBtn').classList.add('hidden');
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
            document.getElementById('endQuizBtn').classList.add('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('levelResult').classList.remove('visible');
            
            updateLevelIndicator();
            loadQuestion();
            startQuizTimer();
        }

        function loadQuestion() {
            const questionIndex = (currentQuizLevel * 10) + currentQuestion;
            if (questionIndex >= quizData.length) {
                endQuiz();
                return;
            }
            
            const question = quizData[questionIndex];
            document.getElementById('questionText').textContent = `Niveau ${currentQuizLevel + 1} - Question ${currentQuestion + 1}: ${question.question}`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = `${String.fromCharCode(65 + index)}) ${option}`;
                optionDiv.onclick = () => selectAnswer(index, question.correct);
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('nextQuestionBtn').disabled = true;
        }

        function selectAnswer(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, index) => {
                option.classList.add('selected');
                if (index === selectedIndex) {
                    if (selectedIndex === correctIndex) {
                        option.classList.add('correct');
                        currentLevelScore++;
                        quizScore++;
                    } else {
                        option.classList.add('incorrect');
                    }
                }
                option.style.pointerEvents = 'none';
            });
            
            document.getElementById('nextQuestionBtn').disabled = false;
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= 10) {
                showLevelResult();
                return;
            }
            
            loadQuestion();
            document.getElementById('nextQuestionBtn').disabled = true;
        }

        function showLevelResult() {
            clearInterval(quizTimerInterval);
            isQuizActive = false;
            
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('quizTimer').style.display = 'none';
            document.getElementById('nextQuestionBtn').classList.add('hidden');
            
            const levelResult = document.getElementById('levelResult');
            const resultLevelNumber = document.getElementById('resultLevelNumber');
            const levelScore = document.getElementById('levelScore');
            const levelMessage = document.getElementById('levelMessage');
            
            resultLevelNumber.textContent = currentQuizLevel + 1;
            levelScore.textContent = `${currentLevelScore}/10`;
            
            if (currentLevelScore === 10) {
                levelMessage.innerHTML = `
                    <div class="level-message success">
                        <strong>üéâ Excellent! Niveau r√©ussi!</strong><br>
                        Vous avez r√©pondu correctement √† toutes les questions.<br>
                        Vous d√©bloquez le niveau suivant!
                    </div>
                `;
                document.getElementById('retryLevelBtn').classList.add('hidden');
                document.getElementById('continueQuizBtn').classList.remove('hidden');
            } else {
                levelMessage.innerHTML = `
                    <div class="level-message fail">
                        <strong>‚ùå Niveau non r√©ussi</strong><br>
                        Score: ${currentLevelScore}/10<br>
                        Vous devez obtenir 10/10 pour passer au niveau suivant.
                    </div>
                `;
                document.getElementById('continueQuizBtn').classList.add('hidden');
                document.getElementById('retryLevelBtn').classList.remove('hidden');
            }
            
            levelResult.classList.add('visible');
        }

        function continueToNextLevel() {
            currentQuizLevel++;
            currentQuestion = 0;
            currentLevelScore = 0;
            
            if (currentQuizLevel >= 7) {
                endQuiz();
                return;
            }
            
            quizTimeLeft = 120;
            
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('quizTimer').style.display = 'block';
            document.getElementById('levelResult').classList.remove('visible');
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
            
            updateLevelIndicator();
            loadQuestion();
            startQuizTimer();
            isQuizActive = true;
        }

        function retryLevel() {
            currentQuestion = 0;
            currentLevelScore = 0;
            quizTimeLeft = 120;
            
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('quizTimer').style.display = 'block';
            document.getElementById('levelResult').classList.remove('visible');
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
            
            loadQuestion();
            startQuizTimer();
            isQuizActive = true;
        }

        function endQuiz() {
            clearInterval(quizTimerInterval);
            isQuizActive = false;
            
            document.getElementById('levelResult').classList.remove('visible');
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('quizTimer').style.display = 'none';
            document.getElementById('nextQuestionBtn').classList.add('hidden');
            document.getElementById('endQuizBtn').classList.remove('hidden');
            
            const resultsDiv = document.getElementById('quizResults');
            const percentage = Math.round((quizScore / 70) * 100);
            
            resultsDiv.innerHTML = `
                <div class="message-item">
                    <h3>üèÜ R√©sultats finaux du Quiz</h3>
                    <p>Score total: <strong>${quizScore}/70</strong> (${percentage}%)</p>
                    <p>Niveaux compl√©t√©s: <strong>${currentQuizLevel}/7</strong></p>
                    <p>${percentage >= 70 ? 'F√©licitations! Vous ma√Ætrisez bien la Gen√®se!' : 
                       percentage >= 50 ? 'Bon travail! Continuez √† √©tudier la Parole de Dieu!' : 
                       'Continuez √† lire et m√©diter la Bible pour am√©liorer vos connaissances!'}</p>
                </div>
            `;
            resultsDiv.classList.remove('hidden');
        }

        function startQuizTimer() {
            clearInterval(quizTimerInterval);
            
            quizTimerInterval = setInterval(() => {
                if (isQuizActive) {
                    quizTimeLeft--;
                    document.getElementById('quizTimer').textContent = quizTimeLeft;
                    
                    if (quizTimeLeft <= 30 && quizTimeLeft > 0) {
                        document.getElementById('quizTimer').style.color = 'var(--accent-color)';
                        document.getElementById('quizTimer').style.animation = 'pulse 1s infinite';
                    }
                    
                    if (quizTimeLeft <= 0) {
                        clearInterval(quizTimerInterval);
                        showLevelResult();
                    }
                }
            }, 1000);
        }

        // ===============================
        // FONCTIONNALIT√âS ADMIN
        // ===============================
        function showAdminModal() {
            document.getElementById('adminModal').classList.add('active');
            document.getElementById('adminPassword').focus();
        }

        function authenticateAdmin() {
            const password = document.getElementById('adminPassword').value.trim();
            
            if (password === 'Binanga 2025') {
                localStorage.setItem('adminAuthenticated', 'true');
                showAdminSections();
                hideAdminModal();
                showNotification('Authentification r√©ussie! Acc√®s administrateur activ√©.', 'success');
            } else {
                document.getElementById('passwordError').classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
                showNotification('Mot de passe incorrect', 'error');
            }
        }

        function showAdminSections() {
            showSection('adminContentSection');
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sermonDate').value = today;
        }

        function hideAdminModal() {
            document.getElementById('adminModal').classList.remove('active');
            document.getElementById('adminPassword').value = '';
            document.getElementById('passwordError').classList.add('hidden');
        }

        // ===============================
        // INITIALISATION
        // ===============================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser PWA
            initializePWA();
            
            // Initialiser les sections
            initializePrayerSection();
            initializeQuizSection();
            
            // Masquer toutes les sections de contenu au d√©marrage
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active-section');
            });
            
            // Gestionnaires d'√©v√©nements - Boutons principaux
            document.getElementById('prayerBtn').addEventListener('click', function() {
                showSection('prayerSection');
            });
            
            document.getElementById('bibleQuizBtn').addEventListener('click', function() {
                showSection('quizSection');
            });
            
            document.getElementById('programBtn').addEventListener('click', function() {
                showSection('programSection');
            });
            
            document.getElementById('sermonsBtn').addEventListener('click', function() {
                showSection('sermonsSection');
            });
            
            document.getElementById('pastorBtn').addEventListener('click', function() {
                window.open('https://wa.me/243851729059?text=Bonjour%20Pasteur,%20je%20viens%20de%20l%27application%20de%20l%27%C3%A9glise', '_blank');
            });
            
            // Gestionnaires - Pri√®re
            document.getElementById('startPrayerBtn').addEventListener('click', startPrayer);
            document.getElementById('pausePrayerBtn').addEventListener('click', pausePrayer);
            document.getElementById('resumePrayerBtn').addEventListener('click', resumePrayer);
            document.getElementById('finishPrayerBtn').addEventListener('click', finishPrayer);
            
            // Gestionnaires - Quiz
            document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            document.getElementById('nextQuestionBtn').addEventListener('click', nextQuestion);
            document.getElementById('continueQuizBtn').addEventListener('click', continueToNextLevel);
            document.getElementById('retryLevelBtn').addEventListener('click', retryLevel);
            document.getElementById('endQuizBtn').addEventListener('click', function() {
                showMainButtons();
            });
            
            // Gestionnaires - Microphone (NOUVEAUX)
            document.getElementById('testMicBtn').addEventListener('click', testMicrophone);
            document.getElementById('startRecordBtn').addEventListener('click', startRecording);
            document.getElementById('stopRecordBtn').addEventListener('click', stopRecording);
            document.getElementById('saveRecordingBtn').addEventListener('click', saveRecording);
            
            // Gestionnaires - Admin
            document.getElementById('adminBtn').addEventListener('click', showAdminModal);
            document.getElementById('closeModalBtn').addEventListener('click', hideAdminModal);
            document.getElementById('submitPasswordBtn').addEventListener('click', authenticateAdmin);
            
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') authenticateAdmin();
            });
            
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('adminAuthenticated');
                // Lib√©rer le stream audio si actif
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    stream = null;
                }
                showMainButtons();
                showNotification('D√©connexion r√©ussie', 'success');
            });
            
            // Fermer modal en cliquant √† l'ext√©rieur
            document.getElementById('adminModal').addEventListener('click', function(e) {
                if (e.target === this) hideAdminModal();
            });
            
            // V√©rifier l'authentification admin
            if (localStorage.getItem('adminAuthenticated') === 'true') {
                // Le contenu admin sera affich√© quand l'utilisateur cliquera sur le bouton admin
            }
            
            // Charger les pr√©dications au d√©marrage
            loadSermons();
        });
    </script>
</body>
</html>
